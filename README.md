---

Это готовый к использованию конфигурационный файл для ядра [mihomo](https://github.com/MetaCubeX/mihomo), оптимизированный для пользователей в России. Основная цель — обеспечить стабильное, быстрое и бесшовное соединение, автоматически переключаясь между прокси и прямым подключением при сбоях.

![image](https://github.com/user-attachments/assets/c39053f9-96a6-4e82-90fb-b3e0c1fdaf97)

## Основные возможности

*   **Полностью автоматический режим работы с отказоустойчивостью (Failover)**.
    *   Сначала используется самый быстрый прокси.
    *   При его отказе — перебор всех остальных живых прокси.
    *   И только если все серверы недоступны, происходит переключение на прямое соединение (`DIRECT`).
    *   Автоматическое восстановление на самый быстрый прокси, как только он снова становится доступен.
*   **Актуальные наборы правил**: используются популярные списки для блокировки рекламы (OISD) и маршрутизации трафика.
*   **Простая настройка**: достаточно указать URL вашей прокси-подписки.

### Логика работы автоматического режима (`ProxyAuto`)

Конфигурация использует многоуровневую систему для максимальной надежности:

1.  Попытка использовать самый быстрый прокси из группы **`ProxyFastest`** (`url-test`).
2.  ➡️ В случае сбоя: переключение на группу **`ProxyFailover`** (`fallback`), которая последовательно перебирает все остальные доступные прокси.
3.  ➡️ В случае сбоя всех прокси: переключение на **`DIRECT`**.

Эта схема гарантирует, что вы останетесь онлайн, пока работает хотя бы один прокси или есть прямое подключение к интернету.

## Быстрый старт

1.  Скачайте файл `config-fallback-sub.yml`.

2.  Откройте файл в текстовом редакторе.

3.  Найдите секцию `proxy-providers` и вставьте URL вашей прокси-подписки в поле `url`.

    ```yaml
    proxy-providers:
      subscription:
        type: http
        # Вставьте вашу ссылку сюда
        url: https://sub.sub.com/54j54kjdj
        # ...
    ```

4.  **Загрузите файл GeoSite.** Этот файл необходим для корректной маршрутизации по доменным именам. Выполните в терминале следующую команду в будущей рабочей директории `mihomo`:

    ```bash
    cd /opt/etc/mihomo && curl -L -o GeoSite.dat https://github.com/v2fly/domain-list-community/releases/download/$(curl -s https://api.github.com/repos/v2fly/domain-list-community/releases/latest | jq -r .tag_name)/dlc.dat
    ```

5.  Переименуйте `config-fallback-sub.yml` в `config.yml`, переместите его вместе с `GeoSite.dat` в рабочую директорию `mihomo` и запустите ядро.

## Настройка под себя

*   **Правила маршрутизации** находятся в секции `rules`. Вы можете добавлять, изменять или удалять их в соответствии с вашими потребностями.
*   **Настройки проверки доступности прокси** (интервалы) можно изменить в секциях `proxy-providers` и `proxy-groups`.

## Автоматическое обновление GeoSite

База доменов GeoSite регулярно обновляется. Чтобы ваша конфигурация всегда использовала актуальные данные, рекомендуется настроить автоматическое обновление. В системах Linux и macOS для этого удобно использовать планировщик задач `cron`.

1.  Откройте редактор `crontab` командой:
    ```bash
    crontab -e
    ```

2.  Добавьте в конец файла следующую строку для ежедневного обновления в 4:20 утра:
    ```crontab
    20 4 * * * cd /opt/etc/mihomo && curl -L -o GeoSite.dat https://github.com/v2fly/domain-list-community/releases/download/$(curl -s https://api.github.com/repos/v2fly/domain-list-community/releases/latest | jq -r .tag_name)/dlc.dat
    ```

## Отказ от ответственности

Конфигурация предоставляется "как есть". Автор не несет ответственности за возможные проблемы, связанные с ее использованием. Используйте на свой страх и риск.
